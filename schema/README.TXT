OpenIAM Database Configuration
------------------------------

This folder contains:
  01_mysql_idm_dbcreate.sql       
  02_mysql_schema_common.sql             
  03_mysql_schema_security.sql
  04_mysql_idm_data.sql
  05_mysql_idm_policy.sql
  06_activedir_config.sql
  mysql_generate_policy_inserts.sh
  mysql_generate_policy_updates.sh
  mysql_remove_users.sql
  README.txt

To configure the database, simply execute scripts 01 through 06.


MIGRATING POLICIES
========================================
Script 05 populates the database with the default set of policies and scripts. Previous
versions of OpenIAM would implement policies as separate groovy script files, whereas
more recent versions only allow configuring through the UI, which in turn accesses the
database backend.


-- MIGRATING FROM EXISTING OPENIAM INSTANCE
-------------------------------------------
If OpenIAM has been upgraded and the backend has remained unchanged, one may import existing
scripts into the database through the following procedure:

    Drop the    mysql_generate_policy_updates.sh    file into the folder containing the
    policy scripts. Running this script will generate an SQL file (target file name can
    be specified as a command line argument) containing all the necessary UPDATE statements
    for copying the script contents to their associated rows within the POLICY table. Policies
    must have unique names for this approach to work.

 NOTE: this script generates UPDATE statements, meaning that the rows for the associated policies
 must already exist within the database.

Once the script contents have been loaded into the POLICY table, one may export the table's data
as a series of insert statements, for example by invoking:
                 mysqldump -u root -p openiam POLICY > out.sql
  
When reinstalling the schemas, one would then execute this file instead of 05_mysql_idm_policy.sql



Alternatively, one can redefine the policy names through the webconsole GUI and then use the script
generated by mysql_generate_policies.sh to populate the tables with the script data.



-- LOADING SCRIPTS WITHOUT EXISTING BACKEND
-------------------------------------------
If there are no existing instances of OpenIAM and a number of policy scripts have to be bulk loaded
into the database:
  1. Drop    mysql_generate_policy_inserts.sh   into the folder containing the scripts
  2. Execute this script. If no argument is specified, a default file "result.sql" will be generated 
  3. Execute the generated script. This will create rows within the database for each policy. Scripts
     can have the same name (naturally, they would have to exist within different folders, but the
     script searches the folders recursively). As the SQL statements have been built from files, the
     policies will lack a description field, which would have to be set later through the GUI.
